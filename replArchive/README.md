# Replication Instructions for the Paper

This repository (`replArchive`) contains all of the code, data, and Docker instructions necessary to reproduce the results discussed in *Decomposing Influence Networks: Social Influence Regression*. Please read this entire document before attempting to replicate the analysis as you will need to adjust file paths, Docker commands, and resources (e.g., CPU cores, RAM).

## 1. Folder Structure

Below is the folder structure within this replication archive:

- **data/**  
  Contains the data files used in the analysis.

- **funcs/**  
  Contains R scripts with helper functions used repeatedly throughout the analysis.

- **graphics/**  
  Contains `.pdf` files for all figures generated by the scripts.

- **results/**  
  Contains `.rda` files with all model output generated by the scripts.

- **Dockerfile**  
  Specifies a Debian GNU (stretch) environment running R 3.4.4 along with all required libraries.

- **repl_soc_infl_reg.sh**  
  A Bash script that sequentially runs all R scripts in the correct order.


## 2. Docker Environment Setup

All analyses should be run inside a Docker container built using the `Dockerfile` in this repository.

### 2.1. Build the Docker Image

1. Open a terminal and navigate to the top-level directory containing this replication archive (where `Dockerfile` is located).

2. Build the Docker image (note that on Apple Silicon, you will get a warning about the architecture, but it should still work):

```bash
docker build --platform=linux/amd64 -t pa-soc-infl-reg .
```

3. Once finished, confirm the image is available:

```bash
docker images
```

You should see `pa-soc-infl-reg` in the list.

### 2.2. Run the Docker Container (RStudio Server)

Below is an example command for Mac/Linux:

```bash
docker run --rm -ti \
  -v ~/Downloads/replArchive:/home/rstudio/replArchive \
  -e USER=rstudio \
  -e PASSWORD=nets \
  -p 8787:8787 \
  pa-soc-infl-reg
```

**Explanation of Key Flags**:
- `-v ~/Downloads/replArchive:/home/rstudio/replArchive` mounts your local `replArchive` directory to `/home/rstudio/replArchive` inside the container. Adjust this path to point wherever you actually saved `replArchive`.
- `-e USER=rstudio` and `-e PASSWORD=nets` sets the login credentials for RStudio Server.
- `-p 8787:8787` maps port 8787 from inside the container to port 8787 on your host machine.

Once running, open a web browser and go to [http://localhost:8787](http://localhost:8787). Use the credentials provided above (or your customized ones) to log in.

#### Windows Paths

If you're on Windows (and not using WSL2), you will need to specify the local path and Docker command differently:

```powershell
docker run --rm -ti ^
  --platform=linux/amd64 ^
  -v C:\Users\sminhas\Downloads\replArchive:/home/rstudio/replArchive ^
  -e USER=rstudio ^
  -e PASSWORD=nets ^
  -p 8787:8787 ^
  pa-soc-infl-reg
```

### 2.3. Docker Resource Settings (Optional)

On some systems (particularly macOS or Windows), Docker may default to only 2GB of RAM or fewer CPU cores. If you encounter performance issues or out-of-memory errors, increase the memory/CPU allocation in Docker Desktop â†’ Settings â†’ Resources.

### 2.4. Confirming R Session Info

Inside the Docker-based RStudio session, running `sessionInfo()` should yield:

```
R version 3.4.4 (2018-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Debian GNU/Linux 9 (stretch)
```

## 3. Running the Full Replication

1. **Log into the RStudio session** at [http://localhost:8787](http://localhost:8787).
2. **Open the Terminal** (within RStudio).
3. **Navigate** to the `/home/rstudio/replArchive` directory.

```bash
cd replArchive
```

4. Run the main Bash script:

```bash
bash repl_soc_infl_reg.sh
```

The script will sequentially call each R script. Below is an overview:

1. **00_install_pkgs.R**  
   - Installs or checks that all required R packages are present.  
   - **Note**: Since the Dockerfile already installs the necessary packages, you typically do not need to manually run this script. Itâ€™s included as a fallback/verification step.

2. **01_plot_descrip.R**  
   - Generates descriptive graphics (Figure 4).
   - Outputs: `figure4_jan05.pdf`, `figure4_dec12.pdf`, and `map.pdf` to `graphics/`.

3. **02_run_model.R**  
   - Runs the main social influence regression model (Table 1).
   - Outputs: `alsModResults.rda` in `results/`.

4. **03_plot_coefs.R**  
   - Creates the coefficient plot for Figure 5.
   - Outputs: `figure5.pdf` in `graphics/`.

5. **04_plot_influence.R**  
   - Visualizes sender and receiver dependence patterns (Figures 6, A2).
   - Outputs multiple PDF files (e.g., `aInfl_2007_06_01.pdf`, `bInfl_2007_06_01.pdf`) in `graphics/`.

6. **05_run_perf.R**  
   - By default, uses **1 core**. If you have sufficient RAM/CPU, you can edit the script and increase the number of cores (look for `registerDoParallel(4)`, for example).
   - Runs cross-validation and temporal forecasting analyses.
   - Outputs: `alsModPerf.rda` and `alsModPerfLastPd.rda` in `results/`.

7. **06_plot_perf.R**  
   - Creates Figures 7 and 8, showing performance results.
   - Outputs: `figure7.pdf` and `figure8.pdf` in `graphics/`.

8. **07_plot_convergence.R**  
   - Produces convergence diagnostics (Figure A1).
   - Outputs: `figurea1.pdf` in `graphics/`.

All log information is saved to `pipeline_log.txt` in the main directory.  

## 4. Example Run Times (Linux & Mac)

Below are two example runs with full timing logs:

### 4.1 Linux Desktop

Using the Docker setup and default scripts (4 cores on `05_run_perf.R`), the replication took **~39 minutes**.  
<details>
<summary>Click to view the Linux log</summary>

```
rstudio@222557d06728:~/replArchive$ bash repl_soc_infl_reg.sh
Clear pdfs from previous runs...
Clear rda files from previous runs...
Clear log files from previous runs...
ğŸš€ Pipeline started at Sun Mar 30 22:04:07 UTC 2025
ğŸ“„ Logging to pipeline_log.txt
ğŸ”¹ Starting 00_install_pkgs.R at Sun Mar 30 22:04:07 UTC 2025
âœ… Finished 00_install_pkgs.R at Sun Mar 30 22:26:16 UTC 2025
ğŸ”¹ Starting 01_plot_descrip.R at Sun Mar 30 22:26:16 UTC 2025
âœ… Finished 01_plot_descrip.R at Sun Mar 30 22:26:19 UTC 2025
ğŸ”¹ Starting 02_run_model.R at Sun Mar 30 22:26:19 UTC 2025
âœ… Finished 02_run_model.R at Sun Mar 30 22:37:06 UTC 2025
ğŸ”¹ Starting 03_plot_coefs.R at Sun Mar 30 22:37:06 UTC 2025
âœ… Finished 03_plot_coefs.R at Sun Mar 30 22:37:08 UTC 2025
ğŸ”¹ Starting 04_plot_influence.R at Sun Mar 30 22:37:08 UTC 2025
âœ… Finished 04_plot_influence.R at Sun Mar 30 22:37:13 UTC 2025
ğŸ”¹ Starting 05_run_perf.R at Sun Mar 30 22:37:13 UTC 2025
âœ… Finished 05_run_perf.R at Sun Mar 30 22:42:52 UTC 2025
ğŸ”¹ Starting 06_plot_perf.R at Sun Mar 30 22:42:52 UTC 2025
âœ… Finished 06_plot_perf.R at Sun Mar 30 22:42:55 UTC 2025
ğŸ”¹ Starting 07_plot_convergence.R at Sun Mar 30 22:42:55 UTC 2025
âœ… Finished 07_plot_convergence.R at Sun Mar 30 22:42:57 UTC 2025
ğŸ Pipeline completed at Sun Mar 30 22:42:57 UTC 2025
ğŸ“„ Full log saved to pipeline_log.txt
```
</details>

### 4.2 MacBook (M1 Max)

Using the exact same Docker image on a **16" M1 Max MacBook** (32GB RAM, 2021) with **1 core** for `05_run_perf.R`, the replication took **~76 minutes**.  
<details>
<summary>Click to view the Mac log</summary>

```
rstudio@a9ab12a9e22f:~/replArchive$ bash repl_soc_infl_reg.sh
Clear pdfs from previous runs...
Clear rda files from previous runs...
Clear log files from previous runs...
ğŸš€ Pipeline started at Sun Mar 30 19:39:05 UTC 2025
ğŸ“„ Logging to pipeline_log.txt
ğŸ”¹ Starting 00_install_pkgs.R at Sun Mar 30 19:39:05 UTC 2025
âœ… Finished 00_install_pkgs.R at Sun Mar 30 19:58:09 UTC 2025
ğŸ”¹ Starting 01_plot_descrip.R at Sun Mar 30 19:58:09 UTC 2025
âœ… Finished 01_plot_descrip.R at Sun Mar 30 19:58:15 UTC 2025
ğŸ”¹ Starting 02_run_model.R at Sun Mar 30 19:58:15 UTC 2025
âœ… Finished 02_run_model.R at Sun Mar 30 20:17:55 UTC 2025
ğŸ”¹ Starting 03_plot_coefs.R at Sun Mar 30 20:17:55 UTC 2025
âœ… Finished 03_plot_coefs.R at Sun Mar 30 20:17:59 UTC 2025
ğŸ”¹ Starting 04_plot_influence.R at Sun Mar 30 20:17:59 UTC 2025
âœ… Finished 04_plot_influence.R at Sun Mar 30 20:18:12 UTC 2025
ğŸ”¹ Starting 05_run_perf.R at Sun Mar 30 20:18:12 UTC 2025
âœ… Finished 05_run_perf.R at Sun Mar 30 20:54:43 UTC 2025
ğŸ”¹ Starting 06_plot_perf.R at Sun Mar 30 20:54:43 UTC 2025
âœ… Finished 06_plot_perf.R at Sun Mar 30 20:54:47 UTC 2025
ğŸ”¹ Starting 07_plot_convergence.R at Sun Mar 30 20:54:47 UTC 2025
âœ… Finished 07_plot_convergence.R at Sun Mar 30 20:54:52 UTC 2025
ğŸ Pipeline completed at Sun Mar 30 20:54:52 UTC 2025
ğŸ“„ Full log saved to pipeline_log.txt
```
</details>

## 5. Required R Packages

All required packages are installed automatically via the `Dockerfile`. These include:

|              |             |               |
|:-------------|:------------|:--------------|
|abind 1.4-5   |foreach 1.4.3 |magrittr 1.5   |
|Cairo 1.5-9   |gbm 2.1.3     |network 1.13.0 |
|countrycode 0.19 |ggplot2 2.2.1 |qgraph 1.4.4|
|cshapes 0.6   |grid 3.4.4    |reshape2 1.4.2 |
|doParallel 1.0.11 |gridExtra 2.3 |scales 0.5.0 |
|dplyr 0.7.4   |igraph 1.1.2  |speedglm 0.3-2 |
|extrafont 0.17 |latex2exp 0.4.0 |stringr 1.3.0 |

## 6. Contact

If you encounter any issues or have questions, please email [minhassh@msu.edu](mailto:minhassh@msu.edu).  
